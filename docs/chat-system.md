# Документация по системе чатов

## Обзор

Система чатов предназначена для общения участников задач в рамках бизнес-процессов. Каждая задача может иметь только один активный чат одновременно.

## Что такое чат

Чат - это инструмент для обсуждения вопросов, связанных с конкретной задачей. В чате могут участвовать:
- Создатель чата
- Контролеры задачи (ответственные)
- Исполнители задачи
- Другие участники, приглашенные в чат

## Основные элементы чата

### Информация о чате
- **Тема** - краткое описание предмета обсуждения
- **Статус** - активен или закрыт
- **Участники** - список всех участников чата
- **История сообщений** - все сообщения в хронологическом порядке

### Типы сообщений
- **Обычные сообщения** - от участников чата
- **Системные сообщения** - автоматические уведомления о действиях (создание чата, добавление участников, выход из чата и т.д.)

## Как работать с чатами

### Создание чата
**Кто может создать чат:**
- Любой пользователь, имеющий доступ к задаче

**Что нужно указать при создании:**
- Тему чата (краткое описание предмета обсуждения)
- Первое сообщение (вопрос или описание проблемы)
- Участников для приглашения (минимум одного)

**Кто автоматически попадает в чат:**
- Вы (как создатель)
- Все ответственные по задаче (контролеры)
- Выбранные вами исполнители

**Ограничения:**
- У каждой задачи может быть только один активный чат
- Нельзя создать новый чат, пока не закрыт предыдущий

### Просмотр чата
**Кто может видеть чат:**
- Создатель чата
- Все участники чата
- Пользователи с доступом к задаче

### Отправка сообщений
**Кто может писать в чат:**
- Только участники активного чата

**Что можно отправлять:**
- Текстовые сообщения
- Файлы (документы, изображения и т.д.)

**Защита от спама:**
- Система не позволяет отправить одинаковое сообщение дважды подряд в течение 10 секунд

### Приглашение новых участников
**Кто может приглашать:**
- Создатель чата
- Любой участник чата

**Кого можно пригласить:**
- Ответственных по задаче (контролеров)
- Исполнителей задачи
- Других работников, связанных с задачей
- Участников, которые ранее покинули чат (могут вернуться)

### Выход из чата
**Кто может выйти:**
- Любой участник, кроме создателя чата
- **Создатель чата не может выйти** - он должен закрыть чат

**Как выйти:**
- Выбрать причину выхода из списка
- После выхода вы перестанете получать уведомления
- Можете вернуться в чат позже

### Закрытие чата
**Кто может закрыть чат:**
- Создатель чата
- Ответственные по задаче (контролеры)
- Исполнители задачи
- Администраторы системы

**Как закрыть:**
- Выбрать причину закрытия из списка
- После закрытия никто не сможет писать в чат
- История сообщений сохраняется

### Автоматическое закрытие
**Когда чат закрывается автоматически:**
- Если в чате нет сообщений более 6 часов
- Причина: "От последнего сообщения прошло слишком много времени"

## Уведомления в Telegram

### Как работают уведомления
- Все участники чата получают уведомления в Telegram
- Уведомления приходят в реальном времени при новых сообщениях
- Система обновляет существующие сообщения вместо создания новых
- При превышении лимита длины старые сообщения удаляются

### Кто получает уведомления
- Только активные участники чата
- Только те, у кого привязан Telegram аккаунт

## Подача жалоб

### Кто может подать жалобу
- Любой активный участник чата

### Как подать жалобу
- Выбрать причину жалобы из списка
- Система автоматически создаст новую задачу
- В задачу попадут все данные о чате и участниках

### Что происходит после подачи жалобы
- Создается новая задача на основе настроенного шаблона
- Автоматически заполняются данные о чате и участниках
- В чат добавляется системное сообщение о подаче жалобы

## Работа с файлами

### Какие файлы можно отправлять
- Документы
- Изображения
- Архивы
- Любые другие файлы

### Безопасность файлов
- Файлы хранятся в защищенной директории
- Каждый файл имеет уникальное имя
- Доступ к файлам имеют только участники чата

### Как скачать файл
- Нажать на ссылку с именем файла в сообщении
- Файл откроется или скачается в зависимости от типа

## История чатов

### Просмотр истории
- Можно посмотреть все чаты, связанные с задачей
- История сохраняется даже после закрытия чата
- Доступ к истории имеют все, кто имеет доступ к задаче

### Отчеты по чатам
- Доступен общий отчет по всем чатам
- Можно фильтровать по различным параметрам
- Есть возможность посмотреть только свои чаты

## Полезные советы

### Эффективное использование чатов
- Четко формулируйте тему чата
- Задавайте конкретные вопросы в первом сообщении
- Приглашайте только тех, кто действительно нужен для решения вопроса

### Управление уведомлениями
- Если не хотите получать уведомления, можете выйти из чата
- Можете вернуться в чат в любое время
- Создатель чата не может выйти - только закрыть чат

### Работа с файлами
- Прикрепляйте файлы к сообщениям для передачи документов
- Все файлы сохраняются и доступны для скачивания
- Будьте осторожны с размером файлов
